<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - LienDeadline.com</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìÖ</text></svg>">
    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    <!-- Tailwind Config to suppress production warning -->
    <script>
        // Suppress Tailwind warnings
        window.tailwind = window.tailwind || {};
        window.tailwind.config = {
            darkMode: false,
            theme: {
                extend: {}
            },
            plugins: []
        };
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Styles loaded via Tailwind CDN -->
    <!-- Privacy-friendly analytics by Plausible -->
    <script defer data-domain="liendeadline.com" src="https://plausible.io/js/script.js"></script>
    
    <!-- Lovable Design System Styles -->
    <link href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital,wght@0,400;0,500;0,600;0,700;1,400&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
      :root {
        --navy: #1e3a8a;
        --coral: #f97316;
        --coral-light: #fed7aa;
        --coral-dark: #ea580c;
        --red: #dc2626;
        --orange: #f59e0b;
        --green: #10b981;
        --background: #faf9f6;
        --foreground: #1f2937;
        --card: #ffffff;
        --border: #e5e7eb;
        --muted: #6b7280;
        --muted-bg: #f3f4f6;
      }
      html { 
        font-family: "Inter", system-ui, sans-serif; 
        -webkit-font-smoothing: antialiased;
        background: var(--background);
      }
      h1, h2, h3, h4, h5, h6 {
        font-family: 'Instrument Serif', serif;
      }
      
      /* Tab Styles */
      .tab-container {
        border-bottom: 2px solid var(--border);
        margin-bottom: 1.5rem;
      }
      .tab-button {
        padding: 0.75rem 1.5rem;
        border: none;
        background: transparent;
        color: var(--muted);
        font-weight: 500;
        cursor: pointer;
        border-bottom: 2px solid transparent;
        margin-bottom: -2px;
        transition: all 0.2s;
      }
      .tab-button:hover {
        color: var(--foreground);
      }
      .tab-button.active {
        color: var(--coral);
        border-bottom-color: var(--coral);
      }
      .tab-content {
        display: none;
      }
      .tab-content.active {
        display: block;
      }
      
      /* Lovable Card Styles */
      .lovable-card {
        background: var(--card);
        border-radius: 0.75rem;
        border: 1px solid var(--border);
        box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        transition: box-shadow 0.2s;
      }
      .lovable-card:hover {
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      }
      
      /* Button Styles */
      .btn-primary {
        background: var(--coral);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        font-weight: 500;
        border: none;
        cursor: pointer;
        transition: background 0.2s;
      }
      .btn-primary:hover {
        background: var(--coral-dark);
      }
      .btn-secondary {
        background: var(--muted-bg);
        color: var(--foreground);
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        font-weight: 500;
        border: 1px solid var(--border);
        cursor: pointer;
        transition: background 0.2s;
      }
      .btn-secondary:hover {
        background: #e5e7eb;
      }
      .btn-danger {
        background: var(--red);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        font-weight: 500;
        border: none;
        cursor: pointer;
        transition: background 0.2s;
      }
      .btn-danger:hover {
        background: #b91c1c;
      }
      .btn-success {
        background: var(--green);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        font-weight: 500;
        border: none;
        cursor: pointer;
        transition: background 0.2s;
      }
      .btn-success:hover {
        background: #059669;
      }
    </style>
</head>
<body class="min-h-screen bg-gray-50">
    <!-- TOP NAVIGATION - Lovable Style -->
    <header class="bg-white shadow-sm border-b border-gray-200 px-6 py-4">
        <div class="flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-bold" style="color: var(--navy);">LienDeadline Admin</h1>
                <p class="text-sm" style="color: var(--muted);">Dashboard for managing brokers and customers</p>
            </div>
            <div class="flex items-center space-x-4">
                <a href="/" class="text-sm font-medium" style="color: var(--coral);">View Site</a>
                <a href="/admin-dashboard-v2" class="text-sm font-medium" style="color: var(--coral); font-weight: 600;">V2 Dashboard</a>
                <button onclick="logout()" class="text-sm font-medium" style="color: var(--muted);">Logout</button>
            </div>
        </div>
    </header>

    <div class="p-6" style="background: var(--background);">
        <!-- PAYOUTS SECTION WITH TABS -->
        <div class="lovable-card mb-8">
            <div class="p-6 border-b border-gray-200">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold" style="color: var(--navy);">üí∞ Payouts</h2>
                    <div class="text-sm" style="color: var(--muted);">
                        <span id="readyToPayCount">0</span> brokers ready
                    </div>
                </div>
                
                <!-- Tabs -->
                <div class="tab-container">
                    <button class="tab-button active" onclick="switchPayoutTab('pending')" id="tab-pending">
                        Pending
                        <span class="ml-2 px-2 py-0.5 rounded-full text-xs bg-yellow-100 text-yellow-800" id="pending-badge">0</span>
                    </button>
                    <button class="tab-button" onclick="switchPayoutTab('paid')" id="tab-paid">
                        Paid
                    </button>
                    <button class="tab-button" onclick="switchPayoutTab('batches')" id="tab-batches">
                        Batches
                    </button>
                </div>
            </div>
            
            <!-- Pending Tab Content -->
            <div id="payout-tab-pending" class="tab-content active">
                <!-- Ready to Pay Section -->
                <div id="readyToPaySection">
            <div class="p-6 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <h2 class="text-lg font-semibold text-gray-900">üí∞ Brokers Ready for Payment</h2>
                    <div class="text-sm text-gray-500">
                        <span id="readyToPayCount">0</span> brokers ready
                    </div>
                </div>
            </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase">Name</th>
                                    <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase">Email</th>
                                    <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase">Amount Owed</th>
                                    <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase">Payment Method</th>
                                    <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase">Payment Address</th>
                                    <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase">Next Payment Due</th>
                                    <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                    <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="ready-to-pay-list" class="divide-y divide-gray-200">
                                <!-- Dynamic broker rows will go here -->
                            </tbody>
                        </table>
                    </div>
                    <!-- Empty State -->
                    <div id="no-ready-to-pay" class="py-12 text-center hidden">
                        <div class="mx-auto w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4">
                            <span class="text-gray-400 text-2xl">‚úÖ</span>
                        </div>
                        <p class="text-gray-500">All brokers are up to date</p>
                        <p class="text-sm text-gray-400 mt-2">No payments due at this time</p>
                    </div>
                </div>
            </div>
            
            <!-- Paid Tab Content -->
            <div id="payout-tab-paid" class="tab-content">
                <div class="p-6">
                    <h3 class="text-lg font-semibold mb-4" style="color: var(--navy);">Payment History</h3>
                    <div class="flex items-center gap-2 mb-4">
                        <button onclick="exportPaymentHistory()" class="btn-secondary text-sm">
                            Export CSV
                        </button>
                        <select id="payment-filter" onchange="loadPaymentHistory()" class="px-3 py-2 text-sm border border-gray-300 rounded-lg">
                            <option value="all">All Payments</option>
                            <option value="month">This Month</option>
                            <option value="week">This Week</option>
                        </select>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
                                    <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase">Broker</th>
                                    <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase">Amount</th>
                                    <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase">Method</th>
                                    <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase">Transaction ID</th>
                                    <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                    <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase">Notes</th>
                                </tr>
                            </thead>
                            <tbody id="payment-history-table" class="divide-y divide-gray-200">
                                <!-- Dynamic rows will go here -->
                            </tbody>
                        </table>
                        <!-- Empty State -->
                        <div id="no-payment-history" class="py-12 text-center hidden">
                            <div class="mx-auto w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4">
                                <span class="text-gray-400 text-2xl">üí∏</span>
                            </div>
                            <p class="text-gray-500">No payment history yet</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Batches Tab Content -->
            <div id="payout-tab-batches" class="tab-content">
                <div class="p-6">
                    <h3 class="text-lg font-semibold mb-4" style="color: var(--navy);">Payment Batches</h3>
                    <p class="text-gray-500 mb-4">Batch payment functionality coming soon. For now, process payments individually from the Pending tab.</p>
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <p class="text-sm text-blue-800">
                            <strong>Note:</strong> Batch payments will allow you to process multiple broker payouts at once. 
                            This feature is currently under development.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- QUICK STATS ROW - Lovable Style -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
            <div class="lovable-card p-5">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-sm text-gray-500">Today's Revenue</p>
                        <p class="text-3xl font-bold text-gray-900" id="todayRevenue">$0</p>
                    </div>
                    <div class="w-12 h-12 bg-blue-50 rounded-lg flex items-center justify-center">
                        <span class="text-blue-600 text-xl">üí∞</span>
                    </div>
                </div>
            </div>
            <div class="lovable-card p-5">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-sm" style="color: var(--muted);">Active Customers</p>
                        <p class="text-3xl font-bold" style="color: var(--foreground);" id="activeCustomers">0</p>
                    </div>
                    <div class="w-12 h-12 bg-green-50 rounded-lg flex items-center justify-center">
                        <span class="text-green-600 text-xl">üë•</span>
                    </div>
                </div>
            </div>
            <div class="lovable-card p-5">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-sm" style="color: var(--muted);">Calculations Today</p>
                        <p class="text-3xl font-bold" style="color: var(--foreground);" id="calculationsToday">0</p>
                    </div>
                    <div class="w-12 h-12 bg-yellow-50 rounded-lg flex items-center justify-center">
                        <span class="text-yellow-600 text-xl">üìä</span>
                    </div>
                </div>
            </div>
            <div class="lovable-card p-5">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-sm" style="color: var(--muted);">Pending Payouts</p>
                        <p class="text-3xl font-bold" style="color: var(--foreground);" id="pendingPayouts">0</p>
                    </div>
                    <div class="w-12 h-12 bg-red-50 rounded-lg flex items-center justify-center">
                        <span class="text-red-600 text-xl">üí∏</span>
                    </div>
                </div>
            </div>
            <div class="lovable-card p-5">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-sm" style="color: var(--muted);">Total Paid (All Time)</p>
                        <p class="text-3xl font-bold" style="color: var(--foreground);" id="totalPaid">$0</p>
                    </div>
                    <div class="w-12 h-12 bg-green-50 rounded-lg flex items-center justify-center">
                        <span class="text-green-600 text-xl">‚úÖ</span>
                    </div>
                </div>
            </div>
            <div class="lovable-card p-5">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-sm" style="color: var(--muted);">Overdue Payments</p>
                        <p class="text-3xl font-bold" style="color: var(--foreground);" id="overduePayments">0</p>
                    </div>
                    <div class="w-12 h-12 bg-orange-50 rounded-lg flex items-center justify-center">
                        <span class="text-orange-600 text-xl">‚ö†Ô∏è</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- MAIN CONTENT - 2 COLUMNS -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- LEFT COLUMN: Pending Actions -->
            <div class="lg:col-span-2 space-y-8">
                <!-- Partner Applications Section - Lovable Style -->
                <div class="lovable-card">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex justify-between items-center">
                            <h2 class="text-lg font-semibold text-gray-900">Partner Applications</h2>
                            <div class="flex items-center space-x-2">
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800">
                                    <span class="w-2 h-2 rounded-full bg-yellow-600 mr-2"></span>
                                    <span id="pendingCount">1</span> Pending
                                </span>
                                <button onclick="exportApplications()" class="px-3 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-50">
                                    Export CSV
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="overflow-x-auto -mx-6 sm:mx-0">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Applicant</th>
                                    <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Commission Model</th>
                                    <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Company</th>
                                    <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Applied</th>
                                    <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                    <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="applicationsTable" class="divide-y divide-gray-200">
                                <!-- Dynamic rows will go here -->
                            </tbody>
                        </table>
                        
                        <!-- Empty State -->
                        <div id="noApplications" class="py-12 text-center">
                            <div class="mx-auto w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4">
                                <span class="text-gray-400 text-2xl">üìã</span>
                            </div>
                            <p class="text-gray-500">No partner applications yet</p>
                        </div>
                    </div>
                </div>

                <!-- Active Brokers Section -->
                <div class="bg-white rounded-xl shadow-sm border">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex justify-between items-center">
                            <h2 class="text-lg font-semibold text-gray-900">Active Brokers</h2>
                            <div class="text-sm text-gray-500">
                                <span id="brokerCount">0</span> brokers
                            </div>
                        </div>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase">Name</th>
                                    <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase">Email</th>
                                    <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase">Commission</th>
                                    <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase">Payment Method</th>
                                    <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase">Payment Status</th>
                                    <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase">Last Payment</th>
                                    <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase">Total Paid</th>
                                    <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="brokersList" class="divide-y divide-gray-200">
                                <!-- Dynamic broker rows will go here -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Empty State -->
                    <div id="noBrokers" class="py-12 text-center hidden">
                        <div class="mx-auto w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4">
                            <span class="text-gray-400 text-2xl">üë•</span>
                        </div>
                        <p class="text-gray-500">No active brokers yet</p>
                        <p class="text-sm text-gray-400 mt-2">Approved partner applications will appear here</p>
                    </div>
                </div>


                <!-- Customers Section -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                    <h2 class="text-lg font-semibold text-gray-900 mb-4">Customers</h2>
                    <div id="customersList" class="space-y-3">
                        <!-- populated -->
                    </div>
                </div>
            </div>

            <!-- RIGHT COLUMN: Analytics & Quick Actions -->
            <div class="space-y-8">
                <!-- System & Quick Actions -->
                <div class="bg-white rounded-xl shadow-sm border">
                    <div class="p-6 border-b border-gray-200">
                        <h2 class="text-lg font-semibold text-gray-900">System & Quick Actions</h2>
                    </div>
                    
                    <div class="p-6">
                        <!-- System Status -->
                        <div class="mb-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="font-medium text-gray-900">System Health</h3>
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800">
                                    <span class="w-2 h-2 rounded-full bg-green-600 mr-2"></span>
                                    All Systems Operational
                                </span>
                            </div>
                            <div class="grid grid-cols-2 gap-3 text-sm">
                                <div class="flex items-center">
                                    <span class="w-3 h-3 rounded-full bg-green-500 mr-2"></span>
                                    <span class="text-gray-700">API: Online</span>
                                </div>
                                <div class="flex items-center">
                                    <span class="w-3 h-3 rounded-full bg-green-500 mr-2"></span>
                                    <span class="text-gray-700">Database: Healthy</span>
                                </div>
                                <div class="flex items-center">
                                    <span class="w-3 h-3 rounded-full bg-green-500 mr-2"></span>
                                    <span class="text-gray-700">Email: Connected</span>
                                </div>
                                <div class="flex items-center">
                                    <span class="w-3 h-3 rounded-full bg-green-500 mr-2"></span>
                                    <span class="text-gray-700">Stripe: Active</span>
                                </div>
                            </div>
                        </div>

                        <!-- Quick Action Buttons -->
                        <div class="mb-6">
                            <h3 class="font-medium text-gray-900 mb-3">Quick Actions</h3>
                            <div class="grid grid-cols-2 gap-3">
                                <button onclick="approveAllPending()" class="px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 text-sm font-medium">
                                    Approve All Pending
                                </button>
                                <button onclick="payAllReady()" class="px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm font-medium">
                                    Pay All Ready ($0)
                                </button>
                                <button onclick="generateTestKey()" class="px-4 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 text-sm font-medium">
                                    Generate Test Key
                                </button>
                                <button onclick="runBackup()" class="px-4 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 text-sm font-medium">
                                    Run Backup Now
                                </button>
                            </div>
                        </div>

                        <!-- Pending Counts -->
                        <div class="border-t pt-4">
                            <h3 class="font-medium text-gray-900 mb-3">Pending Items</h3>
                            <div class="space-y-2">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Partner Applications</span>
                                    <span id="pendingAppsCount" class="px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full text-sm">0</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Ready to Pay</span>
                                    <span id="readyToPayCount" class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm">$0</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Flagged Referrals</span>
                                    <span id="flaggedCount" class="px-3 py-1 bg-red-100 text-red-800 rounded-full text-sm">0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity & Analytics -->
                <div class="space-y-8">
                    <!-- Recent Activity -->
                    <div class="bg-white rounded-xl shadow-sm border">
                        <div class="p-6 border-b border-gray-200">
                            <div class="flex justify-between items-center">
                                <h2 class="text-lg font-semibold text-gray-900">Recent Activity</h2>
                                <button onclick="refreshActivity()" class="text-sm text-blue-600 hover:text-blue-800">
                                    Refresh
                                </button>
                            </div>
                        </div>
                        
                        <div id="activityFeed" class="p-6">
                            <div class="space-y-4">
                                <!-- Activity items will go here -->
                            </div>
                            
                            <!-- Empty State -->
                            <div id="noActivity" class="py-8 text-center hidden">
                                <p class="text-gray-500">No recent activity</p>
                            </div>
                        </div>
                    </div>

                    <!-- Email Conversion -->
                    <div class="bg-white rounded-xl shadow-sm border">
                        <div class="p-6 border-b border-gray-200">
                            <h2 class="text-lg font-semibold text-gray-900">Email Conversion</h2>
                        </div>
                        
                        <div class="p-6">
                            <div class="space-y-4">
                                <div>
                                    <div class="flex justify-between text-sm mb-1">
                                        <span class="text-gray-700">Total Calculations Today</span>
                                        <span id="totalCalcs" class="font-medium">0</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div id="calcBar" class="bg-blue-600 h-2 rounded-full transition-all" style="width: 0%"></div>
                                    </div>
                                </div>
                                
                                <div>
                                    <div class="flex justify-between text-sm mb-1">
                                        <span class="text-gray-700">Email Captures</span>
                                        <span id="emailCaptures" class="font-medium text-blue-600">0</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div id="emailBar" class="bg-blue-600 h-2 rounded-full transition-all" style="width: 0%"></div>
                                    </div>
                                </div>
                                
                                <div>
                                    <div class="flex justify-between text-sm mb-1">
                                        <span class="text-gray-700">Upgrade Clicks</span>
                                        <span id="upgradeClicks" class="font-medium text-green-600">0</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div id="upgradeBar" class="bg-green-600 h-2 rounded-full transition-all" style="width: 0%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Keep existing modals -->

    <!-- Generate Test API Key Modal -->
    <div id="generate-key-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
            <h2 class="text-2xl font-bold mb-4">Generate Test API Key</h2>
            <form id="generate-key-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                    <input type="email" id="test-email" required placeholder="support@liendeadline.com" class="w-full px-4 py-2 border border-gray-300 rounded-md">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Expiry (days)</label>
                    <select id="test-expiration" class="w-full px-4 py-2 border border-gray-300 rounded-md">
                        <option value="7">7 days</option>
                        <option value="14">14 days</option>
                        <option value="30">30 days</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Call Limit</label>
                    <input type="number" id="test-limit" value="50" min="1" max="1000" class="w-full px-4 py-2 border border-gray-300 rounded-md">
                </div>
                <div class="flex gap-4">
                    <button type="submit" class="flex-1 bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700 font-semibold">Generate Key</button>
                    <button type="button" onclick="closeModal('generate-key-modal')" class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-md hover:bg-gray-400 font-semibold">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Approve Broker Modal -->
    <div id="approve-broker-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
            <h2 class="text-2xl font-bold mb-4">Approve Broker</h2>
            <form id="approve-broker-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                    <input type="email" id="broker-email" required placeholder="support@liendeadline.com" class="w-full px-4 py-2 border border-gray-300 rounded-md">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Name</label>
                    <input type="text" id="broker-name" required placeholder="John Smith" class="w-full px-4 py-2 border border-gray-300 rounded-md">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Commission Model</label>
                    <select id="broker-model" class="w-full px-4 py-2 border border-gray-300 rounded-md">
                        <option value="bounty">$500 One-Time Bounty</option>
                        <option value="recurring">$50/month Recurring</option>
                    </select>
                </div>
                <div class="flex gap-4">
                    <button type="submit" class="flex-1 bg-green-600 text-white py-2 rounded-md hover:bg-green-700 font-semibold">Approve</button>
                    <button type="button" onclick="closeModal('approve-broker-modal')" class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-md hover:bg-gray-400 font-semibold">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- View Payment Info Modal -->
    <div id="paymentInfoModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">Broker Payment Information</h2>
                <button onclick="closeModal('paymentInfoModal')" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            <div id="payment-info-content" class="space-y-4">
                <!-- Content will be loaded dynamically -->
            </div>
            <div class="mt-6 flex gap-4">
                <button onclick="closeModal('paymentInfoModal')" class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-md hover:bg-gray-400 font-semibold">Close</button>
            </div>
        </div>
    </div>

    <!-- Mark as Paid Modal -->
    <div id="markPaidModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
            <h2 class="text-2xl font-bold mb-4">Mark Payment as Paid</h2>
            <form id="mark-paid-form" onsubmit="handleMarkPaid(event)" class="space-y-4">
                <input type="hidden" id="paid-broker-id">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Payment Method Used *</label>
                    <select id="paid-method" required class="w-full px-4 py-2 border border-gray-300 rounded-md">
                        <option value="">Select payment method</option>
                        <option value="paypal">PayPal</option>
                        <option value="wise">Wise (TransferWise)</option>
                        <option value="revolut">Revolut</option>
                        <option value="sepa">SEPA Transfer</option>
                        <option value="swift">SWIFT/Wire Transfer</option>
                        <option value="crypto">Cryptocurrency</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Transaction ID / Reference Number *</label>
                    <input type="text" id="paid-transaction-id" required placeholder="WS-12345678" class="w-full px-4 py-2 border border-gray-300 rounded-md">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Amount Paid *</label>
                    <input type="number" id="paid-amount" required step="0.01" min="0" placeholder="100.00" class="w-full px-4 py-2 border border-gray-300 rounded-md">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Notes (Optional)</label>
                    <textarea id="paid-notes" rows="3" placeholder="Paid via Wise batch on Jan 20" class="w-full px-4 py-2 border border-gray-300 rounded-md"></textarea>
                </div>
                <div>
                    <label class="flex items-center">
                        <input type="checkbox" id="paid-confirm" required class="mr-2">
                        <span class="text-sm text-gray-700">I confirm payment was sent</span>
                    </label>
                </div>
                <div class="flex gap-4">
                    <button type="submit" class="flex-1 bg-green-600 text-white py-2 rounded-md hover:bg-green-700 font-semibold">Mark as Paid</button>
                    <button type="button" onclick="closeModal('markPaidModal')" class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-md hover:bg-gray-400 font-semibold">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Plausible Embed -->
    <section class="mt-10 p-6 bg-white rounded shadow">
        <h2 class="text-xl font-bold mb-4">Live Analytics</h2>
        <iframe
            src="https://plausible.io/liendeadline.com?embed=true&theme=light"
            loading="lazy"
            style="width: 100%; height: 600px; border: 0;">
        </iframe>
    </section>

    <!-- Quick numbers -->
    <div class="grid grid-cols-4 gap-4 mt-4 text-center">
        <div class="p-4 bg-gray-100 rounded">
            <div class="text-2xl font-bold" id="pvToday">‚Äî</div>
            <div class="text-sm text-gray-600">Page Views Today</div>
        </div>
        <div class="p-4 bg-gray-100 rounded">
            <div class="text-2xl font-bold" id="uvToday">‚Äî</div>
            <div class="text-sm text-gray-600">Unique Visitors Today</div>
        </div>
        <div class="p-4 bg-gray-100 rounded">
            <div class="text-2xl font-bold" id="calcToday">‚Äî</div>
            <div class="text-sm text-gray-600">Calculations Today</div>
        </div>
        <div class="p-4 bg-gray-100 rounded">
            <div class="text-2xl font-bold" id="paidToday">‚Äî</div>
            <div class="text-sm text-gray-600">Paid Today</div>
        </div>
    </div>

    <!-- ONLY THIS SCRIPT FOR ADMIN DASHBOARD -->
    <script src="/admin-dashboard.js?v=20251213_2"></script>
</body>
</html>

