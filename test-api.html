<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Test the LienDeadline API - Calculate mechanics lien deadlines instantly.">
    <title>Live API Tester - LienDeadline</title>
    
    <!-- Preconnect to Tailwind CDN for faster loading -->
    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="/styles.css">
</head>
<body class="bg-white text-gray-900">
    <!-- Navigation -->
    <nav id="nav" class="fixed top-0 w-full bg-white shadow-sm z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center gap-2">
                    <svg width="40" height="40" viewBox="0 0 40 40" class="text-blue-600">
                        <rect x="4" y="4" width="32" height="32" rx="4" fill="currentColor"/>
                        <text x="20" y="26" text-anchor="middle" fill="white" font-size="16" font-weight="bold">LD</text>
                    </svg>
                    <a href="/" class="text-xl font-bold text-gray-900">LienDeadline.com</a>
                </div>
                <div class="flex gap-4">
                    <a href="/" class="px-4 py-2 text-gray-700 hover:text-gray-900 font-medium">Home</a>
                    <a href="/partners.html" class="px-4 py-2 text-gray-700 hover:text-gray-900 font-medium">Partners</a>
                    <a href="/#pricing" class="px-4 py-2 text-gray-700 hover:text-gray-900 font-medium">Pricing</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Live API Tester Section -->
    <section id="api-tester" class="pt-24 pb-16 px-4 sm:px-6 lg:px-8">
        <div class="max-w-6xl mx-auto">
            <h2 class="text-3xl font-bold text-center mb-8">Live API Tester</h2>
            <form id="api-form" class="p-6 rounded-lg shadow-md">
                <div class="space-y-4">
                    <div>
                        <label for="invoice-date" class="block text-sm font-medium mb-2">Invoice Date</label>
                        <input type="date" id="invoice-date" name="invoice-date" required class="w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="state" class="block text-sm font-medium mb-2">State</label>
                        <select id="state" name="state" required class="w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="">Select state...</option>
                            <option value="AL">Alabama</option>
                            <option value="AK">Alaska</option>
                            <option value="AZ">Arizona</option>
                            <option value="AR">Arkansas</option>
                            <option value="CA">California</option>
                            <option value="CO">Colorado</option>
                            <option value="CT">Connecticut</option>
                            <option value="DE">Delaware</option>
                            <option value="DC">District of Columbia</option>
                            <option value="FL">Florida</option>
                            <option value="GA">Georgia</option>
                            <option value="HI">Hawaii</option>
                            <option value="ID">Idaho</option>
                            <option value="IL">Illinois</option>
                            <option value="IN">Indiana</option>
                            <option value="IA">Iowa</option>
                            <option value="KS">Kansas</option>
                            <option value="KY">Kentucky</option>
                            <option value="LA">Louisiana</option>
                            <option value="ME">Maine</option>
                            <option value="MD">Maryland</option>
                            <option value="MA">Massachusetts</option>
                            <option value="MI">Michigan</option>
                            <option value="MN">Minnesota</option>
                            <option value="MS">Mississippi</option>
                            <option value="MO">Missouri</option>
                            <option value="MT">Montana</option>
                            <option value="NE">Nebraska</option>
                            <option value="NV">Nevada</option>
                            <option value="NH">New Hampshire</option>
                            <option value="NJ">New Jersey</option>
                            <option value="NM">New Mexico</option>
                            <option value="NY">New York</option>
                            <option value="NC">North Carolina</option>
                            <option value="ND">North Dakota</option>
                            <option value="OH">Ohio</option>
                            <option value="OK">Oklahoma</option>
                            <option value="OR">Oregon</option>
                            <option value="PA">Pennsylvania</option>
                            <option value="RI">Rhode Island</option>
                            <option value="SC">South Carolina</option>
                            <option value="SD">South Dakota</option>
                            <option value="TN">Tennessee</option>
                            <option value="TX">Texas</option>
                            <option value="UT">Utah</option>
                            <option value="VT">Vermont</option>
                            <option value="VA">Virginia</option>
                            <option value="WA">Washington</option>
                            <option value="WV">West Virginia</option>
                            <option value="WI">Wisconsin</option>
                            <option value="WY">Wyoming</option>
                        </select>
                    </div>
                    <div>
                        <label for="role" class="block text-sm font-medium mb-2">Role</label>
                        <select id="role" name="role" required class="w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="">Select a role</option>
                            <option value="supplier">Supplier</option>
                            <option value="subcontractor">Subcontractor</option>
                        </select>
                    </div>
                    <div class="flex flex-col sm:flex-row gap-3">
                        <button type="button" id="load-sample-data" aria-label="Load sample data and calculate" class="flex-1 bg-gray-200 text-gray-800 py-3 rounded-md hover:bg-gray-300 font-semibold text-lg">Load Sample Data</button>
                        <button type="submit" id="calculate-btn" aria-label="Calculate mechanics lien deadline" class="flex-1 bg-blue-600 text-white py-3 rounded-md hover:bg-blue-700 font-semibold text-lg flex items-center justify-center">
                            <span id="calculate-text">Calculate</span>
                            <svg id="loading-spinner" class="hidden w-5 h-5 ml-2 animate-spin" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </form>
            <div id="response-container" class="mt-6 hidden">
                <h3 class="text-xl font-semibold mb-3">API Response</h3>
                <div id="error-message" class="hidden mb-4 p-4 bg-red-50 border-l-4 border-red-400 rounded" style="display: none;">
                    <p class="text-red-800 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path></svg>
                        Could not calculate. Please check date / state and try again.
                    </p>
                </div>
                <pre id="api-response" class="p-4 rounded-lg overflow-x-auto text-sm"></pre>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer id="footer" class="py-8 px-4 sm:px-6 lg:px-8 bg-gray-900 text-gray-300">
        <div class="max-w-6xl mx-auto">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <p>&copy; 2025 LienDeadline.com. All rights reserved.</p>
                </div>
                <div class="flex gap-6">
                    <a href="/#faq" class="hover:text-white">FAQ</a>
                    <a href="/#pricing" class="hover:text-white">Pricing</a>
                    <a href="/" class="hover:text-white">Home</a>
                    <a href="/partners.html" class="hover:text-white">Become a Partner</a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // API Tester functionality - inline to ensure it works
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('api-form');
            const responseContainer = document.getElementById('response-container');
            const apiResponse = document.getElementById('api-response');
            const errorMessage = document.getElementById('error-message');
            const calculateBtn = document.getElementById('calculate-btn');
            const calculateText = document.getElementById('calculate-text');
            const loadingSpinner = document.getElementById('loading-spinner');
            const loadSampleBtn = document.getElementById('load-sample-data');

            // Load sample data
            if (loadSampleBtn) {
                loadSampleBtn.addEventListener('click', function() {
                    const today = new Date();
                    const thirtyDaysAgo = new Date(today);
                    thirtyDaysAgo.setDate(today.getDate() - 30);
                    
                    const dateInput = document.getElementById('invoice-date');
                    const stateSelect = document.getElementById('state');
                    const roleSelect = document.getElementById('role');
                    
                    if (dateInput) {
                        dateInput.value = thirtyDaysAgo.toISOString().split('T')[0];
                    }
                    if (stateSelect) {
                        stateSelect.value = 'TX'; // Default to Texas
                    }
                    if (roleSelect) {
                        roleSelect.value = 'supplier';
                    }
                    
                    // Auto-submit after loading sample data
                    setTimeout(() => {
                        form.dispatchEvent(new Event('submit'));
                    }, 500);
                });
            }

            // Form submission
            if (form) {
                form.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const invoiceDate = document.getElementById('invoice-date').value;
                    const state = document.getElementById('state').value;
                    const role = document.getElementById('role').value;
                    
                    if (!invoiceDate || !state || !role) {
                        alert('Please fill in all fields');
                        return;
                    }
                    
                    // Show loading state
                    if (calculateBtn) {
                        calculateBtn.disabled = true;
                    }
                    if (calculateText) {
                        calculateText.textContent = 'Calculating...';
                    }
                    if (loadingSpinner) {
                        loadingSpinner.classList.remove('hidden');
                    }
                    
                    // Hide error message
                    if (errorMessage) {
                        errorMessage.classList.add('hidden');
                    }
                    
                    try {
                        const response = await fetch('/api/v1/calculate-deadline', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                invoice_date: invoiceDate,
                                state: state,
                                role: role,
                                project_type: 'commercial'
                            })
                        });
                        
                        const data = await response.json();
                        
                        if (!response.ok) {
                            throw new Error(data.detail || 'Calculation failed');
                        }
                        
                        // Show response
                        if (responseContainer) {
                            responseContainer.classList.remove('hidden');
                        }
                        if (apiResponse) {
                            apiResponse.textContent = JSON.stringify(data, null, 2);
                            apiResponse.className = 'p-4 rounded-lg overflow-x-auto text-sm bg-gray-50 border border-gray-200';
                        }
                        
                    } catch (error) {
                        console.error('Error:', error);
                        
                        // Show error
                        if (responseContainer) {
                            responseContainer.classList.remove('hidden');
                        }
                        if (errorMessage) {
                            errorMessage.classList.remove('hidden');
                            errorMessage.style.display = 'block';
                        }
                        if (apiResponse) {
                            apiResponse.textContent = `Error: ${error.message}`;
                            apiResponse.className = 'p-4 rounded-lg overflow-x-auto text-sm bg-red-50 border border-red-200 text-red-800';
                        }
                    } finally {
                        // Reset loading state
                        if (calculateBtn) {
                            calculateBtn.disabled = false;
                        }
                        if (calculateText) {
                            calculateText.textContent = 'Calculate';
                        }
                        if (loadingSpinner) {
                            loadingSpinner.classList.add('hidden');
                        }
                    }
                });
            }
        });
    </script>
</body>
</html>

